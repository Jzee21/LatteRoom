# 개인 맞춤 스마트 펜션

## 05/16 (sat)

- 프로젝트 주제 설정
  - IoT 기술을 이용한 개인 맞춤형 스마트팬션
- RFP 작성

## 05/23 (sat)

- 프로젝트 제안서 작성

  - 게스트가 서비스에 제휴된 어떤 숙박시설을 이용하더라도

    게스트 맞춤형 환경을 제공한다

- 피드백, 질의응답

  Q1. 유저와 디바이스가 직접 소켓을 연결을 유지할 필요가 있는가?

  A1. 유저와 디바이스 사이에는 서버가 연결을 관리하고 데이터를 전달한다

  

  Q2. 개인 맞춤 설정을 하지 않은 고객은 어떤 방식으로 서비스를 제공하는가?

  A2. 설정을 하지 않은 고객은 기본적으로 계절별 권장 온도 또는 최대값 대비 약 70%의 밝기, 강도 등으로 설정된다

  

  Q3. 외출모드에 대해서 방마다 제공되는 Wi-fi를 사용한다고 하는데 wi-fi를 사용하지 않는 경우에는 어떻게 되는건가? 디바이스를 제어할 수 없는것 아닌가?

  A3. Wi-fi는 SSID를 이용한 네트워크 변동 감지를 이용한 외출모드의 동작에 사용되기 때문에 Wi-fi를 사용하지 않을 경우 외출모드 기능에만 제한되고  디바이스의 제어는 가능하도록 구현할 예정입니다.

  

  Q4. 사용자가 로그인을 하여 방의 장비를 제어한다. 혹시 다른 디바이스에서 예약된 계정으로 로그인하여 방을 제어할 수 있는가? 보안과 관련된 기능은 이것 뿐인가?

  A4. 현재로서는 예약을 진행한 계정만이 방의 디바이스들을 제어할 수 있다.

  

  Q5. Socket을 이용하는 이유가 있는가

  A5. 초기에 센서로부터 지속적으로 데이터가 유입되었고 즉각적인 제어 요청을 보내기 위해 서버와 디바이스들의 연결을 유지했고 현재 버전에서도 그대로 사용중이다. 개선을 고려하고있다.

  

  Q6. 관리자 UI가 보이지 않는다. 기획중인가

  A6. 현재 관리자 UI에 대해서는 논의가 진행중이다.

  P1. 관리자용 웹 또는 앱, 사용자용 웹 또는 앱을 구분하는것을 추천한다.

  P2. 관리자용 UI에서는 대시보드와 같은 시각화 도구를 이용해 



## 5/26 (tue)

- 시스템 아키텍쳐 설계

  - 23일 Q3, Q4 분석

    - Wifi의 SSID는 외출모드 한정으로 작동하며, 사용자의 ID로 로그인만 된다면 장치의 제어가 가능하다

      현재 접속한 사용자가 예약을 한 당사자인지 확인하는 보안기능이 없다.

    - 개선 : 사용자는 로그인하는 스마트폰의 Mac Address를 등록하고, 제어 요청 시 로그인 정보와 Mac Address를 같이 보내 등록된 기기인지를 확인하도록 한다.

      (기기의 변경은 SMS 인증을 통해 가능하다고 가정한다.)

      (등록 가능한 기기는 1개로 가정하며, 최대 3개로 늘리는 것을 고려해보겠다)

- DB 설계 및 ERD 작성



## 5/27(wed)

- DB 설계 및 ERD 작성

  - 1차 완료!!

- Oracle SYSTEM 계정 PW 확인, 신규 USER 생성

- Java - MAC Address 획득 코드 작성

  - 작성 완료 (String)

  - 원래는 라떼판다 하나당 하나의 디바이스로 가정(네트워크가 가능한 디바이스)하고 진행하여야 하나,

    프로젝트 자원의 부족으로 라떼판다 하나에 2개의 디바이스를 사용한다

    이때 라떼판다의 Mac Addr의 6자리를 이용해 하나는 앞의 4자리, 하나는 뒤의 4자리를 사용하여 ID를 지정하자!

- UI 구성 디테일 회의 1차
  
  - 의도가 엇갈린다...



## 5/28(thu)

- 오전 필답평가 review, test 시행

- 오후 회의 진행

  - Device단 코드 구성

    한정된 장비 갯수로 인해 하나의 LattePanda에서 2개의 장치를 제어해야함

    -> 하나의 LattePanda에서 개별 Arduino(uno/leonardo) 를 제어 (semi의 Devcice 파일 2개 실행)

  - UI 및 제한사항 결정

    - 가정사항

      1. 회원가입은 되어있다고 가정한다.

      2. 방의 예약은 외부 플랫폼에서 가져온다고 가정한다.

      3. 게스트는 등록된 하나의 디바이스에서만 제어가 가능하다

      4. 방에는 최소 하나 이상의 접속 가능한 wi-fi가 존재하며

         숙소 관리자는 이를 방마다 등록한 상태라고 가정한다

    - 기능 규칙

      1. 예약한 날짜의 입실시간이 되면 예약한 게스트에게 방의 제어권한이 자동 지정됨

      2. 게스트는 제어권한이 없으면 방의 장치 정보에 접근이 불가능

      3. 방에는 Wi-fi를 제공하며 게스트는 Wi-fi를 사용할 때에만 방의 제어 기능이 작동함

         만약 Wi-fi에 접속하지 않았으나 제어권한(예약기간 내)이 있으면 작동 상태 확인과 방문 잠금만 가능

      4. 방에 있지만 Wi-fi를 사용하지 않으면 제어 불가능.... 관리자 문의.... 음...

    - UI 결정사항

      1. 로그인을 통과하면 예약한 방 목록 조회
         - 현시간 이후로 예약한 방(퇴실 시간 기준)이 있다면 목록에 보여짐
         - 목록이 없으면 예약 목록이 없다는 화면 표시
      2. 목록에서 방을 선택할 경우
         - 방을 예약한 기간 내(입실 ~ 퇴실)일 경우 방 내부 디바이스를 제어하는 화면 표시
         - 기간 외일 경우 아직 기간이 되지 않아 조회할 수 없습니다 메세지 출력
      3. 디바이스 제어 화면
         - 현재 방 내부의 상태를 보여주는 화면이 상단에 위치
         - 상태를 변경할 수 있는 컴포넌트들이 하단에 위치
      4. 특정 디바이스 제어 요청을 보낼 때
         - 현재 네트워크의 SSID를 확인하고 방의 wi-fi와 동일할 때 전송
         - 동일하지 않으면 ui를 유지하고 사용자에게 알림 표시(제어를 위해서는 방에 제공된 wi-fi를 사용해주세요)



## 5/29(fri)

- Datagram 네트워크 Server, Client 예제코드 작성 완료
- Android Service 공부



## 5/30(sat)

- UDP Service 테스트
- 주간 진행상황 발표
  - (아... 역시 이분들 이전 발표를 크게 기억하지 못하고 계신다란 느낌)
  - UDP 사용 중 인코딩 문제가 발생함 - TCP에서도 해당 문제가 발생하는지 테스트 필요
  - 센서 데이터 - 주말동안 센싱 테스트 진행, 차주 누적된 데이터 분석 예정
  - UDP 말고 기존 구현되어있는 TCP를 사용하는것을 추천



## 6/01(mon)

- 주말간 온도 데이터 분석
  - 튀는 횟수, 오차 범위 확인
  - 실온 누적 온도 변화량  :  23659 / 59749회
  - 최대 온도 변화  :  0.43도 (26.32도 기준 1.63%)



## 6/02(tue)

- 수행평가 작성
- NIO를 이용하는 코드 제작중
  - Server로 데이터 전달 성공
  - Server로 부터 데이터 수신 있으나 조회 불가... + 2중 while문 내부에서 무한루프



## 6/03(wed)

- NIO를 이용한 non blocking 서버 코드 (broadcast)
  - 연결, 전송은 문제 없이 진행되나 부분의 종료가 안됨
- 기존 TCP를 이용하자...



## 06/04(thu)

- Android 에 빠져버린 날...
- Foreground Service를 이용한 Client 구성
- Local Broadcast Reciever를 이용한 Service와 Activity간 통신 구현
- Client의 Auto Reconnection 구현



## 06/08 (mon)

- 로그인 과정 처리를 위한 서버 연결 관리 수정 필요
  - nio server 적용
- DB 컬럼 삭제, 자료형 사이즈 수정
- DB 수정으로 인한 ERD 수정
- 데이터 흐름(request) 분석
- 트랜잭션 분기 형태 정리중



## 06/09 (tue)

- myBatis 적용
  - DB BLOB 타입의 이미지 >> url을 이용한 이미지 사용으로 변경
  - [imgur](https://imgur.com/) 사용
- DB 컬럼명, 일부 사이즈 수정
- 테스트 데이터 입력
- 일부 sql 작성



## 06/10 (wed)

- 데이터 플로우, 요청 응답 양식 작성
- 주간보고 작성



## 06/11 (thu)

- 주간보고 수정, 제출
- 발표 세트 구상



## 06/12 (fri)

- Query문 테스트



## 06/13 (sat)

- 로그인 정보 로딩 확인
- NIO 타겟 전송 실패